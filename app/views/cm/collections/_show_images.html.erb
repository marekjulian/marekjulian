<% initialMainVariant = nil %>
<% if @collection %>
    <% images = @collection.images %>
    <% images.each do | image | %>
        <% image.image_variants.each do | imageVariant | %>
            <% if imageVariant.is_web_default %>
                <% initialMainVariant = imageVariant %>
                <% break %>
            <% end %>
        <% end %>
    <% end %>
<% end %>
<div class="ArchiveList">
    <% if @collection %>
        <div class="ArchiveListHeading">
            <%= render :partial => "heading", :locals => { :label => "Collection" } %>
        </div>
        <% images = @collection.images %>
        <% images.each do | image | %>
            <% thumbnailVariant = nil %>
            <% mainVariant = nil %>
            <% image.image_variants.each do | imageVariant | %>
                <% if imageVariant.is_thumbnail_default %>
                    <% thumbnailVariant = imageVariant %>
                <% end %>
                <% if imageVariant.is_web_default %>
                    <% mainVariant = imageVariant %>
                <% end %>
            <% end %>
            <div class="ArchiveListElement">
                <div class="ArchiveListLink">
                    <% if image.description == nil %>
                        <% description = "?" %>
                    <% else %>
                        <% description = image.description %>
                    <% end %>
                    <%= link_to description, cm_archive_collection_image_path( @archive, @collection, image.id ), :class => "NavLink" %>
                </div>
                <% if thumbnailVariant %>
                    <% if mainVariant %>
                        <% thumbnailElem = image_variant_tag thumbnailVariant %>
                        <% mainElem = image_variant_tag mainVariant %>
                        <div class="ArchiveListThumbnail">
                            <%= link_to_function thumbnailElem do | page |
                                page[:ArchiveMainImage].replace_html mainElem
                            end %>
                        </div>
                    <% else %>
                        <div class="ArchiveListThumbnail">
                            <%= thumbnailElem = image_variant_tag thumbnailVariant %>
                        </div>
                    <% end %>
                <% end %>
            </div>
        <% end %>
    <% end %>
</div>
<div id="ArchiveMainImage" class="ArchiveMainImage">
    <% if initialMainVariant %>
        <%= image_variant_tag initialMainVariant %>
    <% end %>
</div>
